# Правила и стандарты разработки в Datareon ESB

- [Правила и стандарты разработки в Datareon ESB](#правила-и-стандарты-разработки-в-datareon-esb)
  - [Назначение документа](#назначение-документа)
  - [Регламент работы с классами Datareon ESB](#регламент-работы-с-классами-datareon-esb)
    - [Правила образования наименования обработчика](#правила-образования-наименования-обработчика)
    - [Регламент разработки обработчиков Datareon ESB](#регламент-разработки-обработчиков-datareon-esb)
  - [Версионирование обработчиков](#версионирование-обработчиков)
  - [Правила комментирования](#правила-комментирования)
    - [Шаблон комментария в обработчиках](#шаблон-комментария-в-обработчиках)
    - [Общие правила комментирования](#общие-правила-комментирования)

## Назначение документа

Определение внутреннего корпоративного стандарта разработки обработчиков 1С Datareon ESB в целях улучшения качества производимого программного продукта, оптимизации трудозатрат на поддержку и развитие прикладных решений.

## Регламент работы с классами Datareon ESB

- Класс информационного сообщения создается архитектором с заполненной структурой

### Правила образования наименования обработчика

Наименование обработчика формируется по шаблону [АктуальностьОбработчика]\_[КонтурРазработки]\_[СистемаОбмена]\_[НаименованиеОбработчика]\_[ТипОбработчика]  в стиле CamelCase, где

- [АктуальностьОбработчика] - пометка на удаление обработчика, признак не используемого, устаревшего обработчика. Принимает значение "Удалить", актуальные обработчики игнорируют данный параметр.

- [КонтурРазработки] - признак определяющий использование обработчика в интеграционном контуре, принимает следующие значения:
  - "Т" - контура разработки/тестирования.
  - "П" - контур рабочей, продуктивной среды.

- [СистемаОбмена] - наименование системы к которой подключен обработчик.
  
- [НаименованиеОбъектаСистемы] - следует образовывать от терминов объектов системы с которомы взаимодействует обработчик.

При разработке служебного исходящего обработчика, хранящего алгоритм интеграции, добавляется к [НаименованиеОбъектаСистемы] добавляется префикс "Служебный", в типе объекта обработчика указывается

    Пример наименования - "Т_Ерп_СлужебныйЗаполнитьНоменклатуру_Исходящий"

    Пример вызова служебного обработчика:

    ```bsl
    
    спрДокКорРеализации.Расхождения.Очистить();
    КорРеализацияОбъект = спрДокКорРеализации;
    Выполнить(грОбработкаПакетовИнтеграции.ПолучитьТекстОбработчика("Т_Ерп_СлужебныйЗаполнитьРасхожденияКорректировкиРеализации_Исходящий", 
    Перечисления.сшпТипыИнтеграции.Исходящая));
    
    ```

- [ТипОбработчика] - признак определяющий использование обработчика в интеграционном контуре, принимает следующие значения:
  - "Т" - контура разработки/тестирования.
  - "П" - контур рабочей, продуктивной среды.

Примеры наименования обработчиков:

- Т_ЕРП_ЗаказПоставщику_Исходящий - обработчик тестового контура
- П_ЕРП_ЗаказПоставщику_Исходящий - обработчик продуктивного контура
- Т_ЕРП_СлужебныйСборкаДокументАктОРасхождении_Исходящий- служебный обработчик тестового контура
- Удалить_Т_ЕРП_ЗаказПоставщику_Исходящий - не используемый обработчик тестового контура
- Удалить_Т_ЕРП_ЗаказПоставщику_Исходящий

### Регламент разработки обработчиков Datareon ESB

- Инструменты для отладки обработчиков :
  - [**сшпОтладкаОбработчиков.epf**](./сшпОтладкаОбработчиков.epf) -  отладка исходящих / входящих обработчиков
  - [**сшпОтладкаОбработчиковСВходящейОчередью.epf**](./сшпОтладкаОбработчиковСВходящейОчередью) отладка входящих обработчиков, возможность получения сообщений из очереди входящих обработчиков

- Интеграционный обработчик имеет стандартную структуру, описание структуры и концептуальные функции подсистемы интеграции определены в эталонном обработчике **ЭталонныйОбработчик.bsl** (предоставляет архитектор ESB);

- При разработке новых обработчиков необходимо по возможности следовать структуре эталонного обработчика
Структура эталонного обработчика
- Возможные отклонения структуры разрабатываемого интеграционного обработчика от эталона должны быть согласованы с архитектором ESB;
- При разработке обработчиков необходимо использовать функции общих модулей грОбработкаПакетовИнтеграции, грОбработкаПакетовИнтеграцииПовтИсп, которые содержат интеграционные методы, обеспечивающие работу с  Таблицей Переходных Ключей (далее ТПК) и другими аспектами, реализованными для систем 1С8 в рамках проекта;
- Инициативы по доработке библиотеки концептуальных функций подсистемы интеграции обсуждаются с архитектором ESB;
- Код интеграционного обработчика должен удовлетворять общим требованиям к оформлению кода.
- Тестирование обработчиков ведется на контуре "Витрина" в обработчиках с префиксом «Т_.

- Перенос изменений протестированных обработчиков выполняется архитектором с фиксацией версии тестового обработчика в комментарии.

## Версионирование обработчиков

Версионирование обработчиков реализовано с помощью коннектора GIT.

## Правила комментирования

### Шаблон комментария в обработчиках

// Градум; <ФамилияИсполнителя> (<?"", ДатаВремя, "ДФ='dd.mm.yyyy'">)); №.<НомерЗадачиЕРП> <НазваниеЗадачиЕРП> №<НомерЗадачиВнеш>

- НомерЗадачиЕРП - Номер задачи из AxelotERP.
- НазваниеЗадачиЕРП - Название задачи из AxelotERP.
- НомерЗадачиВнеш - Номер задачи из трекера заказчика. Указывается в задаче на разработку.

При изменении блоков кода необходимо указывать начало и окончание вносимых изменений. При этом, комментарий блока кода в начале должен начинаться с //+++, а комментарий в конце с //---.

__после символа "// " необходим пробел, инче автоматизированные системы проверки кода будут указывать на ошибку.__

Пример комментария:

    ```bsl

    // +++ Градум; Смирнов; 25.01.2021; №0000176234 №ITMNK-00380 
    // Измененный/Добавленный код
    // --- Градум; Смирнов; 25.01.2021; №0000176234 №ITMNK-00380 

    ```

### Общие правила комментирования

- Простой код необходимо писать и структурировать так, чтобы никаких дополнительных пояснений к нему не требовалось.
- Комментарии, которые не поясняют, а пересказывают код, недопустимы.
- Сложный код необходимо сопровождать сжатыми и четкими пояснениями.
- Длинные линейные фрагменты кода при помощи комментариев необходимо разбивать на фрагменты.
- Если код требует комментария для пояснения работы - в первую очередь необходимо рассмотреть варианты рефакторинга, чтобы код не требовал комментария.
- Длина строки комментария не должна превышать 120 символов.
