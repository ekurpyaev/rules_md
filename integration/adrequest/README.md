# "Дозапросы"

- ["Дозапросы"](#дозапросы)
  - [Подсистема "Дозапросы"](#подсистема-дозапросы)
    - [Формат дозапроса](#формат-дозапроса)
    - [Объекты подсистемы](#объекты-подсистемы)
    - [Взаимодействие с DATAREON ESB](#взаимодействие-с-datareon-esb)

## Подсистема "Дозапросы"

Подсистема предназначена для формирования, отправки запросов на получение объектов из систем интеграционного контура.

### Формат дозапроса

Дозапрос представлен xml пакетов с обязательными тегами:

- ID - идентификатор объекта ( уникальный ключ)
- Class - идентификатор интеграционного потока ( idflow ). Описание идентификаторов хранится в служебном обработчике DatareonESB "ИдентификаторыПотоковESB".

[Идентификаторы потоков ESB](ИдентификаторыПотоковESB.bsl)

```xml
<classData xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ID> 618 C5AN1001</ID>
  <Class>320</Class>
</classData>

<classData xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ID> 618 C5AN1001</ID>
  <Class>497_Bitrix_BITRIXGUID</Class>
</classData>
```



### Объекты подсистемы

1. **Справочник "Очередь дозапросов"** - служебное хранилище типов интеграционных объектов с описанием алгоритма сборки составного объекта.

![Очередь дозапросов](Очередь дозапросов.png.png)

1. **Регистр сведений "Источники дозапросов"** - хранилище дозапросов.

![Элемент справочника Объекты (Градум)  ](ЭлементСправочникаОбъекты.png)

### Взаимодействие с DATAREON ESB

В качестве репозитория хранения алгоритмов справочника "Типы объектов (Градум) могут выступать обработчики DATAREON ESB.
Для включения данного функционала требуется:

1. Подключить информационную систему к DATAREON ESB.
2. Указать в настройке по умолчанию "*ПрефиксОбработчиковСборки". Поиск обработчиков выполняется по шаблону [ПрефиксОбработчиковСборки]+[%].
3. Вызвать команду "Обновить алгоритмы сборки из ESB".

![Алгоритм справочника Типы объектов (Градум)](АлгоритмыТипыОбъектов.png)
