# "Таблица переходных ключей"

- ["Таблица переходных ключей"](#таблица-переходных-ключей)
  - [Подсистема "Таблица переходных ключей"](#подсистема-таблица-переходных-ключей)
  - [Условные обозначения](#условные-обозначения)
    - [Объекты подсистемы](#объекты-подсистемы)
    - [Программный интерфейс](#программный-интерфейс)
    - [Примеры использования](#примеры-использования)

## Подсистема "Таблица переходных ключей"

Подсистема предназначена для хранения индентификатаров объектов интеграционных систем.

## Условные обозначения

### Объекты подсистемы

- **Регистр сведений "Таблица переходных ключей ERP"** - хранилище индентификатаров объектов интеграционных систем.
  - Измерения:
    - ИдентификаторОбъекта - Строка(36) - индентификатор объекта, уникальный ключ.
    - ВидИдентификатораСтрока - Строка(50) - идентификатор описания интеграционного потока ( idflow ). Формируется по шаблону {МетаданныеПолноеИмяМастерСистема}\_{МастерСистема}\_{ВидКлюча},
УНИКУМ использует цифровой код. Описания используемых idflow хранится в служебном обработчике Datareon ESB ["ИдентификаторыПотоковESB"](/integration/adrequest/ИдентификаторыПотоковESB.bsl).
Для просмотра текущих idflow используется отчет  ["Получение записей идентфикаторов потоков ESB"](/integration/adrequest/ПолучитьЗаписиИдентфикаторыПотоковESB.epf)
    - ОбъектERP - ЛюбаяСсылка - ссылка на объект базы данных.
    - ВнешняяСистема - СправочникСсылка.грСистемыИнтеграционногоКонтура - система источник
  - Ресурсы:
    - Версия - Строка(36) - версия ИдентификаторОбъекта
    - Удален - Булево - признак непосредственного удаления в системе источник
  - Реквизиты:
    - ДатаОбновления - Дата - дата обновления записи.
    - ДатаДокумента - Дата - не используется.
    - НомерДокумента - Дата - не используется.

### Программный интерфейс

Программный итерфейс расположен в общем модуле "грОбработкаПакетовИнтеграции" область "ПрограммныйИнтерфейс_РС_грТаблицаПереходныхКлючейERP".

- **УстановитьКлюч_v2**
  
  Функция устанавливает уникальный идентификатор объекта

  Синтаксис

```bsl
// Функция устанавливает уникальный идентификатор объекта
//
// Параметры:
// СсылкаНаОбъект                  - ЛюбаяСсылка   - Ссылка на объект для записи
// Ключ                    - Строка        - идентификатора объекта
// СистемаОбмена          - СправочникСсылка.грСистемыИнтеграционногоКонтура - имя внешней системы
// УстанавливаемыеРеквизиты - Структура - См ПолучитьПараметрыУстановкиИндентификатораОбъекта:
//    * Версия - Строка,Число - версия идентификатора объекта, необяазательный, необязательный параметр
//    * ДатаОбновления - Дата - дата обновления записи, по умолчанию устанавливается текущая дата сеанса , необязательный параметр
//    * Удален - Булево - признак непостредственного удаления объекта, необязательный параметр
//
// Возвращаемое значение
// Булево
//
Функция УстановитьКлюч_v2( СсылкаНаОбъект, Ключ, СистемаОбмена, УстанавливаемыеРеквизиты = Неопределено) Экспорт
```

  Пример вызова

```bsl
   грОбработкаПакетовИнтеграции.УстановитьКлюч_v2(
   СсылкаНаДокумент, 
   Ключ, 
   СистемаОтправитель,  
   новый Структура(
   "ВидИдентификатораСтрока, ДатаОбновления, Версия",
   ВидИдентификатора,
   ПараметрыОбработки.ВремяПакета, ВерсияОбъекта));
```

- **ПолучитьОбъектПоКлючуТПК**

  Функция ищет объект по индентификатору объекта в регистре сведений "Таблица переходных ключей ERP"

  Синтаксис

```bsl
/// Функция ищет объект по ключу ТПК
// Параметры:
//  Ключ - Строка - идентификатор объекта;
//  МетаданныеПолноеИмя - Строка - полное имя метаданных;
//  ВидИдентификатора - Строка - вид идентификатора;
//  ПараметрыОбработкиСообщения - Структура - см. ПолучитьПараметрыОбработкиСообщения.
// Возвращаемое значение: Структура
//  Ссылка - ссылка на найденный объект или Неопределено, если объект не найден;
//  ДатаИзменения - Дата - дата последнего изменения объекта;
//  ИзменениеРазрешено - Булево;
//  Объект - СправочникОбъект, ДокументОбъект или Неопределено, если объект не найден или ИзменениеРазрешено = Ложь.
//
Функция ПолучитьОбъектПоКлючуТПК(Ключ, МетаданныеПолноеИмя, ВидИдентификатора,
         ПараметрыОбработкиСообщения = Неопределено, 
         Версия = Неопределено,
         ДополнительныеПараметры = Неопределено) Экспорт
```

### Примеры использования
